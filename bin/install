#!/bin/bash

do_install() {
  # Clone the terrastories repository to a known location in /opt/terrastories
  git clone https://github.com/rubyforgood/terrastories.git /opt/terrastories
  cd /opt/terrastories && bin/bootstrap && bin/setup

  # Create a symbolic link to the executable scripts in /bin
  cd /bin && ln -s /opt/terrastories/bin/start.sh terrastories-start
  cd /bin && ln -s /opt/terrastories/bin/update.sh terrastories-update

  # Create a symbolic link to the upstart service configuration
  cd /etc/init && ln -s /opt/terrastories/conf/terrastories.conf

  # Stat the terrastories service
  initctl reload-configuration
  service start terrastories
}

while true; do
    read -p "This is not a typical development command. It will install \
terrastories as a service intended for a deployed production environment. Are \
you sure you want to proceed? y/N " yn
    case $yn in
        [Yy]* ) do_install; break;;
        * ) exit;;
    esac
done
